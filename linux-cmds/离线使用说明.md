# Linux Command Plugin 离线使用说明

## 概述

本插件现在支持完全离线运行。当网络不可用时，插件会自动降级使用本地离线数据，确保用户在任何环境下都能正常使用。

## 数据加载策略

### 多级数据源策略

插件采用三级数据源策略，确保在各种网络环境下都能正常工作：

1. **网络数据** (优先) - 从 `unpkg.com` 获取最新数据
2. **缓存数据** - 24小时内的 localStorage 缓存
3. **本地数据** (最终保障) - 内置的离线数据文件

### 数据加载流程

```
1. 检查 localStorage 缓存 (24小时内有效)
   ↓
2. 尝试从网络获取最新数据 (后台更新)
   ↓
3. 如果网络失败，使用本地离线数据
   ↓
4. 如果本地数据也不存在，显示错误信息
```

## 离线数据文件结构

为了确保插件完全离线运行，需要包含以下数据文件：

### 必需文件

```
public/
├── data.json              # 命令概述数据 (必需)
└── command/               # 命令详情目录 (必需)
    ├── ls.md
    ├── cd.md
    ├── pwd.md
    ├── cat.md
    ├── grep.md
    ├── find.md
    ├── ps.md
    ├── kill.md
    └── ... (其他命令的 .md 文件)
```

### 文件说明

- **data.json**: 包含所有命令的基本信息（名称、描述等）
- **command/*.md**: 每个命令的详细 Markdown 文档

## 离线功能特性

### 1. 搜索功能
- ✅ 完全离线搜索
- ✅ 智能排序（按匹配程度和使用频率）
- ✅ 虚拟滚动优化

### 2. 命令详情
- ✅ 离线查看命令文档
- ✅ 友好的错误提示
- ✅ 优雅的降级体验

### 3. 个性化功能
- ✅ 收藏管理（本地存储）
- ✅ 历史记录（本地存储）
- ✅ 使用频率统计（本地存储）
- ✅ 热门推荐（基于本地使用数据）

### 4. 用户体验
- ✅ 移动端适配
- ✅ 键盘导航
- ✅ 响应式设计

## 部署要求

### 最小部署
如果只需要基本功能，至少需要：
- `public/data.json` - 命令列表数据
- `public/command/` 目录下的常用命令文档

### 完整部署
为了获得最佳离线体验，建议包含：
- 完整的 `data.json` 文件
- 所有命令的 Markdown 文档

## 网络异常处理

### 数据加载失败
当网络不可用时，插件会：
1. 显示友好的加载提示
2. 自动切换到本地数据
3. 在后台继续尝试网络连接
4. 网络恢复后自动更新数据

### 详情加载失败
当命令详情无法加载时，插件会：
1. 显示默认的命令信息
2. 提供离线使用说明
3. 保持界面可用性

## 性能优化

### 虚拟滚动
- 初始只加载 20 个结果（移动端 10 个）
- 滚动时动态加载更多
- 避免一次性渲染大量 DOM 元素

### 缓存策略
- 24小时数据缓存
- 用户数据持久化存储
- 智能数据更新机制

## 测试建议

### 离线测试
1. 断开网络连接
2. 重新加载插件
3. 验证以下功能：
   - 搜索功能是否正常
   - 命令详情是否能查看
   - 收藏和历史记录是否保存
   - 热门推荐是否显示

### 网络恢复测试
1. 在离线状态下使用插件
2. 恢复网络连接
3. 验证数据是否自动更新

## 故障排除

### 常见问题

**Q: 插件显示"加载数据失败"**
A: 检查 `public/data.json` 文件是否存在且格式正确

**Q: 命令详情无法加载**
A: 检查 `public/command/` 目录下对应的 `.md` 文件是否存在

**Q: 搜索功能不正常**
A: 确保 `data.json` 文件包含完整的命令数据

**Q: 收藏和历史记录丢失**
A: 检查浏览器是否清除了 localStorage

### 调试信息
插件会在控制台输出详细的加载日志，帮助诊断问题：
- 数据源加载状态
- 网络请求结果
- 错误信息详情

## 总结

通过完善的离线数据支持和优雅的降级策略，本插件现在具备了真正的离线运行能力。用户可以在任何网络环境下获得一致的使用体验，同时享受网络恢复后的自动数据更新。

对于开发者来说，只需要确保包含必要的离线数据文件，插件就能在各种网络条件下稳定运行。
